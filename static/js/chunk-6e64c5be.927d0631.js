/*!
 *  build: admin-vue-antd 
 *  copyright: AndPHP 417170808@qq.com 
 *  time: 2021-7-5 10:54:23
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e64c5be","chunk-2d231044"],{3041:function(e,t,r){"use strict";r.r(t);var n=r("f2bf"),a=Object(n["withScopeId"])("data-v-5d8a2046");Object(n["pushScopeId"])("data-v-5d8a2046");var o=Object(n["createTextVNode"])(" 筛选条件 "),c={key:0};Object(n["popScopeId"])();var l=a((function(e,t,r,l,u,s){var i=Object(n["resolveComponent"])("p-tree"),d=Object(n["resolveComponent"])("a-col"),p=Object(n["resolveComponent"])("p-query"),f=Object(n["resolveComponent"])("p-table"),m=Object(n["resolveComponent"])("a-row"),h=Object(n["resolveComponent"])("p-form"),b=Object(n["resolveComponent"])("p-modal");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(m,{type:"flex",gutter:20},{default:a((function(){return[Object(n["createVNode"])(d,{flex:"300px"},{default:a((function(){return[Object(n["createVNode"])(i,{title:"选择部门",onSelect:l.onSelectDep,ref:"tree",url:e.depUrl,"default-expand-all":"","show-all":!0},null,8,["onSelect","url"])]})),_:1}),Object(n["createVNode"])(d,{flex:1},{default:a((function(){return[Object(n["createVNode"])(p,{ref:"query","search-param":e.queryArray,onSearch:l.handleSearch,onReset:l.handleReset},{title:a((function(){return[o]})),_:1},8,["search-param","onSearch","onReset"]),e.selectList.length?(Object(n["openBlock"])(),Object(n["createBlock"])("div",c,[Object(n["createVNode"])(f,{"row-key":"id",columns:e.columns,"form-item":e.formItem,"default-form-model":e.defaultFormModel,"option-tip-field":"username","action-url":e.actionUrl,param:e.param,fetch:l.fetch,operate:e.operate,ref:"tableRef"},null,8,["columns","form-item","default-form-model","action-url","param","fetch","operate"])])):Object(n["createCommentVNode"])("",!0)]})),_:1})]})),_:1}),Object(n["createVNode"])(b,{visible:e.roleShow,"onUpdate:visible":t[1]||(t[1]=function(t){return e.roleShow=t}),forceRender:!0,title:"分配角色",onOk:l.handleRoleOK,onCancel:l.handleRoleCancel},{default:a((function(){return[Object(n["createVNode"])(h,{ref:"formRef","form-schema":e.formSchema},null,8,["form-schema"])]})),_:1},8,["visible","onOk","onCancel"])],64)})),u=r("5530"),s=r("1da1"),i=(r("a15b"),r("96cf"),r("ef6c")),d={name:"staff",components:{},setup:function(){var e=Object(n["ref"])(null),t=Object(n["ref"])(null),r=Object(n["getCurrentInstance"])(),a=r.proxy,o=function(e){return{formItemLayout:{labelCol:{span:4},wrapperCol:{span:14}},formItem:[{type:"tree-select",label:"角色",field:"roleId",value:["0"],treeData:Object(n["computed"])((function(){return c.roleSelectList})),placeholder:"请选择角色",props:{multiple:!0,treeDefaultExpandAll:!0},rules:[]}]}},c=Object(n["reactive"])({param:{department_id:""},columns:[{title:"用户名",dataIndex:"username",key:"username",sorter:!1},{title:"姓名",dataIndex:"realname",key:"realname",sorter:!1},{title:"所属部门",dataIndex:"departmentName",key:"departmentName",sorter:!1},{title:"所属岗位",dataIndex:"position",key:"position",sorter:!1},{title:"是否启用",key:"status",dataIndex:"status",customRender:function(e){e.text;var r=e.record;e.index;return r.status=r.status>0,Object(n["createVNode"])(Object(n["resolveComponent"])("a-switch"),{"checked-children":"是","un-checked-children":"否",checked:r.status,"onUpdate:checked":function(e){return r.status=e},onChange:function(e,n){Object(i["disable"])({id:r.id,status:e?1:0}).then((function(e){0==e.code?a.$message.success("设置成功"):t.value.reload()}))}},null)}},{title:"所属角色",dataIndex:"roleName",key:"roleName",sorter:!1},{title:"IP",dataIndex:"lastIp",key:"lastIp",sorter:!1},{title:"登录时间",dataIndex:"lastLoginAt",key:"lastLoginAt",sorter:!1}],defaultFormModel:{id:"",username:"",realname:"",departmentId:0,departmentName:"",position:"",password:"123456"},formItem:[{type:"input",label:"用户名",field:"username",value:"",props:{placeholder:"用户名"},rules:[{required:!0,message:"不能为空"}]},{type:"input",label:"姓名",field:"realname",value:"",props:{placeholder:"姓名"},rules:[{required:!1,message:"不能为空"}]},{type:"password",label:"密码",field:"password",value:"",tip:"默认密码为123456",props:{placeholder:"请输入密码"},rules:[{required:!0,message:"不能为空"}]},{type:"tree-select",label:"所属部门",field:"departmentId",value:0,treeData:Object(n["computed"])((function(){return c.selectList})),props:{placeholder:"所属部门"},rules:[{required:!1,message:"不能为空"}]},{type:"input",label:"所属岗位",field:"position",value:"",props:{placeholder:"所属岗位"},rules:[{required:!1,message:"不能为空"}]}],actionUrl:{add:"/manage/user/create",edit:"/manage/user/update",del:"/manage/user/delete",batchDel:"/manage/user/delete"},operate:[{label:"分配角色",event:function(e){d(e)}}],roleShow:!1,formSchema:o(e),selectList:[],roleSelectList:[],currentUser:null,depUrl:"manage/department/select",queryArray:[{type:"input",key:"username",value:"",label:"用户名",hidden:!1,props:{placeholder:"用户名"}},{type:"input",key:"realname",value:"",label:"姓名",hidden:!1,props:{placeholder:"姓名"}},{type:"input",key:"position",value:"",label:"岗位",hidden:!1,props:{placeholder:"岗位"}}]}),l=function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["list"])(t);case 2:return r=e.sent,n=r.data,e.abrupt("return",{total:n.total,data:n.data});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(t){c.currentUser=t,e.value.modelRef.roleId=t.roleIds,c.roleShow=!0},p=function(){var r=Object(s["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=e.value.modelRef,Object(i["setRole"])({user_id:c.currentUser.id,role_ids:n.roleId.join(",")}).then((function(e){0==e.code&&(a.$message.success("分配成功"),t.value.reload())})),c.roleShow=!1;case 3:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),f=function(){e.value.modelRef.roleId=["0"],c.roleShow=!1};Object(n["onBeforeMount"])((function(){})),Object(n["onMounted"])((function(){Object(i["selectList"])().then((function(e){var t=e.data;c.selectList=t})),Object(i["roleSelectList"])().then((function(e){var t=e.data;c.roleSelectList=t}))})),Object(n["onBeforeUpdate"])((function(){})),Object(n["onUpdated"])((function(){})),Object(n["onBeforeUnmount"])((function(){})),Object(n["onUnmounted"])((function(){}));var m=function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.node,n=r.node.dataRef,a=r.node.dataRef.extend,n.key||n.id?c.param.department_id=a.id:c.param.department_id="";case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),h=function(e){c.param=e},b=function(e){table.value.reload()};return Object(u["a"])(Object(u["a"])({},Object(n["toRefs"])(c)),{},{fetch:l,formRef:e,tableRef:t,roleClick:d,handleRoleOK:p,handleRoleCancel:f,onSelectDep:m,handleSearch:h,handleReset:b})}};r("ef4e8");d.render=l,d.__scopeId="data-v-5d8a2046";t["default"]=d},"3e174":function(e,t,r){},ef4e8:function(e,t,r){"use strict";r("3e174")},ef6c:function(e,t,r){"use strict";r.r(t),r.d(t,"list",(function(){return c})),r.d(t,"selectList",(function(){return u})),r.d(t,"roleSelectList",(function(){return i})),r.d(t,"setRole",(function(){return p})),r.d(t,"disable",(function(){return m}));var n=r("1da1"),a=(r("96cf"),r("b775")),o="manage";function c(e){return l.apply(this,arguments)}function l(){return l=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(a["default"])({url:o+"/user/list",method:"get",params:t}));case 1:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function u(e){return s.apply(this,arguments)}function s(){return s=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(a["default"])({url:o+"/department/select",method:"get",params:t}));case 1:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function i(e){return d.apply(this,arguments)}function d(){return d=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(a["default"])({url:o+"/role/select",method:"get",params:t}));case 1:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return f=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(a["default"])({url:o+"/user/setting_role",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return h=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(a["default"])({url:o+"/user/disable",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}}}]);